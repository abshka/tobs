# üïµÔ∏è‚Äç‚ôÇÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –ò—â–µ–º "–£–±–∏–π—Ü—É CPU"

–í—ã –ø—Ä–∞–≤—ã, —Å–æ–º–Ω–µ–Ω–∏—è –æ–ø—Ä–∞–≤–¥–∞–Ω—ã. "–°–µ—Ç–µ–≤–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å" ‚Äî —É–¥–æ–±–Ω–æ–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–∏–µ, –Ω–æ —Ä–∞–∑–±—Ä–æ—Å –≤ 100 —Å–µ–∫—É–Ω–¥ (643 ‚Üí 751) —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫.

–ï—Å–ª–∏ —ç—Ç–æ **–Ω–µ —Å–µ—Ç—å**, —Ç–æ —á—Ç–æ-—Ç–æ **–±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop** Python.

## –ì–∏–ø–æ—Ç–µ–∑–∞: "–¢–∏—Ö–∏–π —É–±–∏–π—Ü–∞" (Event Loop Starvation)

Python –∞—Å–∏–Ω—Ö—Ä–æ–Ω–µ–Ω, –Ω–æ –æ–¥–Ω–æ–ø–æ—Ç–æ—á–µ–Ω (GIL). –ï—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ–ª–≥–æ (–¥–∞–∂–µ 10–º—Å), –æ–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –í–ï–°–¨ —ç–∫—Å–ø–æ—Ä—Ç.

**–ü–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ:**

1. **ResourceMonitor (TIER C-4)**
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `psutil` (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏)
   - –ï—Å–ª–∏ –æ–Ω –∑–∞–Ω–∏–º–∞–µ—Ç 50–º—Å ‚Üí —ç—Ç–æ –º–∏–∫—Ä–æ-—Ñ—Ä–∏–∑—ã

2. **InputPeerCache (TIER C-3)**
   - –ï—Å–ª–∏ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `iter_messages`, —ç—Ç–æ —Ç—ã—Å—è—á–∏ lookup'–æ–≤
   - –ù–æ –¥–ª—è —Ñ–æ—Ä—É–º–æ–≤ –æ–Ω, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

3. **BloomFilter (TIER B-4)**
   - –ú—ã —É–∂–µ –≤—ã—è—Å–Ω–∏–ª–∏, —á—Ç–æ –¥–ª—è —Ñ–æ—Ä—É–º–æ–≤ –æ–Ω **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**
   - –ó–Ω–∞—á–∏—Ç, –æ–Ω –æ–ø—Ä–∞–≤–¥–∞–Ω ‚úÖ

## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –û—Ç–∫–ª—é—á–∏—Ç—å ResourceMonitor (–°–î–ï–õ–ê–ù–û)

–Ø –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª –∑–∞–ø—É—Å–∫ ResourceMonitor –≤ `src/export/exporter.py`.

```python
# await resource_monitor.start()  # <--- DISABLED
logger.info("üö´ ResourceMonitor DISABLED for performance regression test")
```

### –®–∞–≥ 2: –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω (Run 4)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.

**–ï—Å–ª–∏ –≤—Ä–µ–º—è –≤–µ—Ä–Ω—ë—Ç—Å—è –∫ ~650s:**
‚Üí –í–∏–Ω–æ–≤–Ω–∏–∫: **ResourceMonitor** (psutil –±–ª–æ–∫–∏—Ä—É–µ—Ç loop)

**–ï—Å–ª–∏ –≤—Ä–µ–º—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è ~700-750s:**
‚Üí –í–∏–Ω–æ–≤–Ω–∏–∫: **–°–µ—Ç—å Telegram / Server-side throttling** (–º–æ—è –≥–∏–ø–æ—Ç–µ–∑–∞ –≤–µ—Ä–Ω–∞)

---

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç

```bash
python -m tobs export
```

–°–º–æ—Ç—Ä–∏–º –Ω–∞ –∏—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è.

### –û–∂–∏–¥–∞–Ω–∏—è:
- **< 660s**: –ú—ã –Ω–∞—à–ª–∏ –ø—Ä–æ–±–ª–µ–º—É! (ResourceMonitor)
- **> 690s**: –≠—Ç–æ –≤—Å—ë-—Ç–∞–∫–∏ —Å–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä Telegram.

–ñ–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞! üïµÔ∏è‚Äç‚ôÇÔ∏è
