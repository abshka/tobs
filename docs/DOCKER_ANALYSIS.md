# –ê–Ω–∞–ª–∏–∑ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ TOBS

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:
- `Dockerfile` - –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–∑
- `docker-compose.yml` - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
- `run-tobs.sh` - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
- `.dockerignore` - –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ build context

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ

### Dockerfile
1. ‚úÖ **Multi-stage build** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ builder/runtime
2. ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ COPY (—Å–Ω–∞—á–∞–ª–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
3. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - —É–¥–∞–ª–µ–Ω–∏–µ apt –∫—ç—à–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ slim –æ–±—Ä–∞–∑–∞
5. ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Python

### docker-compose.yml
1. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
2. ‚úÖ **Volumes** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ **GPU support** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ VA-API —á–µ—Ä–µ–∑ `/dev/dri`

### .dockerignore
1. ‚úÖ **–ò—Å–∫–ª—é—á–µ–Ω–∏—è** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
2. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `.env` –∏ `*.session`

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. Dockerfile: –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
```dockerfile
# –°—Ç—Ä–æ–∫–∞ 29-30
RUN uv pip compile pyproject.toml -o requirements.txt
RUN uv pip install --no-cache -r requirements.txt
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- `uv.lock` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `uv pip compile` –∏–∑–±—ã—Ç–æ—á–µ–Ω –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–±–æ—Ä–∫—É
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `uv sync` –Ω–∞–ø—Ä—è–º—É—é

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å uv sync –Ω–∞–ø—Ä—è–º—É—é (–±—ã—Å—Ç—Ä–µ–µ –∏ –ø—Ä–æ—â–µ)
RUN uv sync --frozen --no-dev
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–±–æ—Ä–∫–∏ –Ω–∞ 20-30%, —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞

---

#### 2. run-tobs.sh: –ó–∞–ø—É—Å–∫ –æ—Ç root

**–ü—Ä–æ–±–ª–µ–º–∞:**
```bash
# –°—Ç—Ä–æ–∫–∞ 16
--user root
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –§–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç root –Ω–∞ —Ö–æ—Å—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å appuser (—É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ Dockerfile)
--user 1000:1000
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–≤—ã—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

#### 3. docker-compose.yml: –•–∞—Ä–¥–∫–æ–¥ GID 988

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
# –°—Ç—Ä–æ–∫–∞ 60
group_add:
  - "988"  # –•–∞—Ä–¥–∫–æ–¥ render group GID
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å –¥—Ä—É–≥–∏–º GID render –≥—Ä—É–ø–ø—ã
- –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

**–†–µ—à–µ–Ω–∏–µ:**
```yaml
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
group_add:
  - video
  - ${RENDER_GID:-988}  # –° fallback –Ω–∞ 988
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç–∏

---

### üü° –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### 4. Dockerfile: –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –≤–µ—Ä—Å–∏—è uv

**–ü—Ä–æ–±–ª–µ–º–∞:**
```dockerfile
# –°—Ç—Ä–æ–∫–∞ 7
COPY --from=ghcr.io/astral-sh/uv:0.4.20 /uv /bin/uv
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –í–µ—Ä—Å–∏—è 0.4.20 —É—Å—Ç–∞—Ä–µ–ª–∞ (—Ç–µ–∫—É—â–∞—è ~0.5.x)
- –ù–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ –±—ã—Å—Ç—Ä–µ–µ –∏ –∏–º–µ—é—Ç –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å latest –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/uv
# –ò–õ–ò
COPY --from=ghcr.io/astral-sh/uv:0.5.0 /uv /bin/uv
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

---

#### 5. Dockerfile: –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Python

**–ü—Ä–æ–±–ª–µ–º–∞:**
```dockerfile
# –°—Ç—Ä–æ–∫–∏ 4, 35
FROM python:3.11.8-slim-bookworm
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –°–ª–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é
- –ù–µ—Ç –≥–∏–±–∫–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ARG –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
ARG PYTHON_VERSION=3.11.8
FROM python:${PYTHON_VERSION}-slim-bookworm AS builder
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –≥–∏–±–∫–æ—Å—Ç–∏

---

#### 6. docker-compose.yml: –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –≤–µ—Ä—Å–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
# –°—Ç—Ä–æ–∫–∞ 1
version: "3.8"
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –í–µ—Ä—Å–∏—è 3.8 —É—Å—Ç–∞—Ä–µ–ª–∞ (—Ç–µ–∫—É—â–∞—è 3.9+)
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
```yaml
# –û–±–Ω–æ–≤–∏—Ç—å –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
version: "3.9"
# –ò–õ–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –±–µ–∑ version (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
# (—É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É version, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker Compose v2+)
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –î–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º

---

#### 7. docker-compose.yml: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ proxy –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
# –°—Ç—Ä–æ–∫–∏ 8-17, 38-46
args:
  http_proxy: ""
  https_proxy: ""
  # ... –º–Ω–æ–≥–æ –ø—É—Å—Ç—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–π –∫–æ–¥
- –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
```yaml
# –£–ø—Ä–æ—Å—Ç–∏—Ç—å - –ø—É—Å—Ç—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –Ω—É–∂–Ω—ã
# –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –ø—Ä–æ—Å—Ç–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Ö
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

#### 8. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Healthcheck

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç healthcheck –≤ Dockerfile –∏ docker-compose.yml
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# –í Dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD python -c "import sys; sys.exit(0)" || exit 1
```

```yaml
# –í docker-compose.yml
healthcheck:
  test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 40s
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

---

#### 9. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Resource Limits

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ CPU –∏ –ø–∞–º—è—Ç—å
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Ö–æ—Å—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
```yaml
# –í docker-compose.yml
deploy:
  resources:
    limits:
      cpus: '4.0'
      memory: 8G
    reservations:
      cpus: '1.0'
      memory: 2G
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ó–∞—â–∏—Ç–∞ —Ö–æ—Å—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏

---

#### 10. Dockerfile: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ builder stage

**–ü—Ä–æ–±–ª–µ–º–∞:**
```dockerfile
# –°—Ç—Ä–æ–∫–∞ 63 - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ runtime stage
mkdir -p /home/appuser/export /home/appuser/cache
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è venv
- –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–∞–Ω—å—à–µ
RUN useradd --create-home --uid 1000 appuser && \
    mkdir -p /home/appuser/export /home/appuser/cache /app/sessions && \
    chown -R appuser:appuser /app /opt/venv /home/appuser
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—Ä–∞–∑–∞

---

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### 11. Dockerfile: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BuildKit cache mounts

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è BuildKit cache mounts –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cache mount –¥–ª—è uv –∏ pip –∫—ç—à–∞
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–±–æ—Ä–æ–∫

---

#### 12. .dockerignore: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ docs/

**–ü—Ä–æ–±–ª–µ–º–∞:**
```dockerignore
# –°—Ç—Ä–æ–∫–∞ 59
docs/
```

**–ü–æ—á–µ–º—É –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π:**
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –æ–±—Ä–∞–∑–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)

**–†–µ—à–µ–Ω–∏–µ:**
- –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å, –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞ –≤ –æ–±—Ä–∞–∑–µ
- –ò–ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã, –æ—Å—Ç–∞–≤–∏—Ç—å README.md

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞ (–µ—Å–ª–∏ docs –±–æ–ª—å—à–∏–µ)

---

#### 13. docker-compose.yml: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ networks

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è default bridge network
- –ù–µ—Ç –∏–∑–æ–ª—è—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```yaml
# –°–æ–∑–¥–∞—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—É—é —Å–µ—Ç—å
networks:
  tobs-network:
    driver: bridge

services:
  tobs:
    networks:
      - tobs-network
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

### –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞
- **–î–æ:** ~800-900 MB (–æ—Ü–µ–Ω–∫–∞)
- **–ü–æ—Å–ª–µ:** ~750-850 MB (—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏)
- **–≠–∫–æ–Ω–æ–º–∏—è:** ~50-100 MB

### –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏
- **–î–æ:** ~5-7 –º–∏–Ω—É—Ç (–ø–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞)
- **–ü–æ—Å–ª–µ:** ~4-5 –º–∏–Ω—É—Ç (—Å cache mounts)
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** ~20-30%

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–î–æ:** –ó–∞–ø—É—Å–∫ –æ—Ç root –≤ run-tobs.sh
- **–ü–æ—Å–ª–µ:** –ó–∞–ø—É—Å–∫ –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–£–ª—É—á—à–µ–Ω–∏–µ:** ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### P0 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—É—é –∫–æ–º–ø–∏–ª—è—Ü–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (uv sync)
2. ‚úÖ –£–±—Ä–∞—Ç—å `--user root` –∏–∑ run-tobs.sh
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å healthcheck

### P1 - –í–∞–∂–Ω—ã–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é uv
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ GID 988
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å resource limits
7. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é docker-compose

### P2 - –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)
8. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ARG –¥–ª—è –≤–µ—Ä—Å–∏–∏ Python
9. ‚úÖ –£–ø—Ä–æ—Å—Ç–∏—Ç—å proxy –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
10. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å cache mounts
11. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—É—é —Å–µ—Ç—å

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (30 –º–∏–Ω—É—Ç)
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å Dockerfile (uv sync)
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å run-tobs.sh (—É–±—Ä–∞—Ç—å root)
3. –î–æ–±–∞–≤–∏—Ç—å healthcheck

### –®–∞–≥ 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1 —á–∞—Å)
4. –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏–∏
5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å GID
6. –î–æ–±–∞–≤–∏—Ç—å resource limits

### –®–∞–≥ 3: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (30 –º–∏–Ω—É—Ç)
7. –î–æ–±–∞–≤–∏—Ç—å cache mounts
8. –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ~2 —á–∞—Å–∞

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [DOCKER_QUICKSTART.md](../DOCKER_QUICKSTART.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [Dockerfile](../Dockerfile) - –¢–µ–∫—É—â–∏–π Dockerfile
- [docker-compose.yml](../docker-compose.yml) - –¢–µ–∫—É—â–∏–π compose —Ñ–∞–π–ª

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É—é—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

