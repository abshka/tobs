# Media Processing Module

–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –∏–∑ Telegram.

## üéâ –°–¢–ê–¢–£–°: –†–ï–§–ê–ö–¢–û–†–ò–ù–ì –ó–ê–í–ï–†–®–ï–ù + –ü–û–õ–ù–û–ï –¢–ï–°–¢–û–í–û–ï –ü–û–ö–†–´–¢–ò–ï!

**‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã**
**‚úÖ –°—Ç–∞—Ä—ã–π –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω**
**‚úÖ 141 —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ (100% pass rate)**
**‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ 23.80% (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–¥—É–ª–∏ 80%+)**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**Test Suite Status:** ‚úÖ 141/141 passing
**Execution Time:** ~4.8 seconds
**Coverage:** 23.80% overall (critical modules: 80-100%)

### Coverage by Module

- ‚úÖ `models.py` ‚Äî **100%** (12 tests)
- ‚úÖ `cache.py` ‚Äî **93.33%** (14 tests)
- ‚úÖ `metadata.py` ‚Äî **87.10%** (11 tests)
- ‚úÖ `processors/base.py` ‚Äî **86.67%** (7 tests)
- ‚úÖ `validators.py` ‚Äî **83.33%** (16 tests)
- ‚úÖ `processors/image.py` ‚Äî **72.92%** (9 tests)
- ‚úÖ `processors/audio.py` ‚Äî **54.36%** (12 tests)
- ‚úÖ `downloader.py` ‚Äî **49.11%** (8 tests)

**Run tests:**

```bash
# All tests
uv run pytest tests/media/

# With coverage
uv run pytest tests/media/ --cov=src/media --cov-report=html

# Fast (no coverage)
uv run pytest tests/media/ --no-cov
```

See [TESTING_PROGRESS.md](../../TESTING_PROGRESS.md) for full report.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/media/
‚îú‚îÄ‚îÄ __init__.py              # –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã
‚îú‚îÄ‚îÄ models.py                # Data models (MediaMetadata, ProcessingSettings, ProcessingTask)
‚îú‚îÄ‚îÄ hardware.py              # HardwareAccelerationDetector - –¥–µ—Ç–µ–∫—Ü–∏—è GPU
‚îú‚îÄ‚îÄ metadata.py              # MetadataExtractor - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ FFmpeg/PIL
‚îú‚îÄ‚îÄ validators.py            # MediaValidator - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ cache.py                 # MediaCache - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ downloader.py            # MediaDownloader - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Telegram ‚úÖ –ì–û–¢–û–í–û
‚îú‚îÄ‚îÄ manager.py               # MediaProcessor - –≥–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îî‚îÄ‚îÄ processors/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ base.py             # BaseProcessor - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å
    ‚îú‚îÄ‚îÄ video.py            # VideoProcessor ‚úÖ –ì–û–¢–û–í–û
    ‚îú‚îÄ‚îÄ audio.py            # AudioProcessor ‚úÖ –ì–û–¢–û–í–û
    ‚îî‚îÄ‚îÄ image.py            # ImageProcessor ‚úÖ –ì–û–¢–û–í–û
```

## –°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª–µ–π

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

- `models.py` (60 —Å—Ç—Ä–æ–∫) - Dataclasses
- `hardware.py` (166 —Å—Ç—Ä–æ–∫) - –î–µ—Ç–µ–∫—Ü–∏—è –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è
- `metadata.py` (162 —Å—Ç—Ä–æ–∫) - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- `validators.py` (166 —Å—Ç—Ä–æ–∫) - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- `cache.py` (69 —Å—Ç—Ä–æ–∫) - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- `downloader.py` (499 —Å—Ç—Ä–æ–∫) - **‚úÖ Persistent & Standard –∑–∞–≥—Ä—É–∑–∫–∞**
- `manager.py` (785 —Å—Ç—Ä–æ–∫) - **‚úÖ –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (–∫–æ–º–ø–æ–∑–∏—Ü–∏—è)**
- `processors/base.py` (55 —Å—Ç—Ä–æ–∫) - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
- `processors/video.py` (707 —Å—Ç—Ä–æ–∫) - **‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ —Å VAAPI/NVENC/QSV**
- `processors/audio.py` (360 —Å—Ç—Ä–æ–∫) - **‚úÖ –¢—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
- `processors/image.py` (366 —Å—Ç—Ä–æ–∫) - **‚úÖ PIL –æ–±—Ä–∞–±–æ—Ç–∫–∞, resize, EXIF rotation**

### üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ

- ~~`media_processor.py` (2719 —Å—Ç—Ä–æ–∫)~~ - **–£–î–ê–õ–ï–ù** - –∑–∞–º–µ–Ω–µ–Ω –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

---

## üì¶ MediaDownloader

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **Persistent Download** - –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ **Standard Download** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (15)
- ‚úÖ **Resume Support** - –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å –º–µ—Å—Ç–∞ –æ–±—Ä—ã–≤–∞
- ‚úÖ **Adaptive Timeouts** - —Ç–∞–π–º–∞—É—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
- ‚úÖ **Progress Callbacks** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Rich progress bars
- ‚úÖ **Connection Manager Integration** - —Å–µ–º–∞—Ñ–æ—Ä—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ **Statistics Tracking** - –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—Ö–æ–≤/–Ω–µ—É–¥–∞—á

### API

```python
from src.media import MediaDownloader

downloader = MediaDownloader(connection_manager, temp_dir)

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
path = await downloader.download_media(message, progress_queue, task_id)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = downloader.get_statistics()
downloader.log_statistics()
```

---

## üé¨ VideoProcessor

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **VAAPI Hardware Acceleration** - GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è Intel/AMD
- ‚úÖ **NVENC Support** - –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é NVIDIA –∫–æ–¥–µ–∫–æ–≤
- ‚úÖ **QSV Support** - –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Intel Quick Sync
- ‚úÖ **Software Fallback** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –Ω–∞ libx264
- ‚úÖ **GPU Scaling** - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ GPU —á–µ—Ä–µ–∑ scale_vaapi
- ‚úÖ **Adaptive Processing** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –±–æ–ª—å—à–∏—Ö/–Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ **Audio Stream Detection** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ
- ‚úÖ **Smart Copy Fallback** - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö FFmpeg
- ‚úÖ **Statistics Tracking** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ HW/SW –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è

### API

```python
from src.media.processors import VideoProcessor

processor = VideoProcessor(
    io_executor,
    cpu_executor,
    hw_detector,
    metadata_extractor,
    config
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ FFmpeg –∏ HW acceleration)
await processor.initialize()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ
success = await processor.process(task, worker_name)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = processor.get_statistics()
processor.log_statistics()
```

### –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ

1. **VAAPI** (Intel/AMD GPU) - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –≤—ã–±–æ—Ä
    - –ö–æ–¥–µ–∫–∏: `h264_vaapi`, `hevc_vaapi`
    - –§–∏–ª—å—Ç—Ä—ã: `format=nv12`, `hwupload`, `scale_vaapi`

2. **NVENC** (NVIDIA GPU) - –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
    - –ö–æ–¥–µ–∫–∏: `h264_nvenc`, `hevc_nvenc`

3. **QSV** (Intel Quick Sync) - –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
    - –ö–æ–¥–µ–∫–∏: `h264_qsv`, `hevc_qsv`

4. **Software Fallback** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç
    - –ö–æ–¥–µ–∫: `libx264`

---

## üéµ AudioProcessor

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **FFmpeg Transcoding** - AAC/MP3 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ **Bitrate Optimization** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∏—Ç—Ä–µ–π—Ç –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ **Codec Checking** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–µ–∫–∞
- ‚úÖ **File Integrity Validation** - —á–µ—Ä–µ–∑ MediaValidator
- ‚úÖ **Smart Fallback** - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **Statistics Tracking** - transcoded/copied stats

### API

```python
from src.media.processors import AudioProcessor

processor = AudioProcessor(
    io_executor,
    cpu_executor,
    validator,
    config
)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ
success = await processor.process(task, worker_name)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = processor.get_statistics()
processor.log_statistics()
```

---

## üñºÔ∏è ImageProcessor

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **PIL/Pillow Processing** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ **EXIF Rotation** - –∞–≤—Ç–æ–ø–æ–≤–æ—Ä–æ—Ç –ø–æ EXIF –¥–∞–Ω–Ω—ã–º
- ‚úÖ **Smart Resizing** - thumbnail —Å LANCZOS resampling
- ‚úÖ **RGBA ‚Üí RGB Conversion** - –¥–ª—è JPEG —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ **Progressive JPEG** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **Quality Optimization** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- ‚úÖ **Size Threshold** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>5MB)
- ‚úÖ **Statistics Tracking** - optimized/copied stats

### API

```python
from src.media.processors import ImageProcessor

processor = ImageProcessor(
    io_executor,
    cpu_executor,
    config
)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
success = await processor.process(task, worker_name)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = processor.get_statistics()
processor.log_statistics()
```

---

## Environment Variables

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
PROCESS_VIDEO=false      # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–æ
PROCESS_AUDIO=true       # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ
PROCESS_IMAGES=true      # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ

# –ó–∞–≥—Ä—É–∑–∫–∞
PERSISTENT_DOWNLOAD_MODE=true
PERSISTENT_MIN_SIZE_MB=0.5
MAX_CONCURRENT_DOWNLOADS=3
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from src.media import MediaProcessor, ProcessingSettings

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
processor = MediaProcessor(...)

# –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏
result = await processor.download_and_process_media(message, output_path)
```

---

## –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π
2. ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≥–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (hardware, metadata, validators, cache)
3. ‚úÖ **MediaDownloader - –ì–û–¢–û–í–û** (499 —Å—Ç—Ä–æ–∫)
4. ‚úÖ **VideoProcessor - –ì–û–¢–û–í–û** (707 —Å—Ç—Ä–æ–∫)
5. ‚úÖ **AudioProcessor - –ì–û–¢–û–í–û** (360 —Å—Ç—Ä–æ–∫)
6. ‚úÖ **ImageProcessor - –ì–û–¢–û–í–û** (366 —Å—Ç—Ä–æ–∫)
7. ‚úÖ **–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –≤ manager.py**
8. ‚úÖ **–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ media_processor.py (2719 —Å—Ç—Ä–æ–∫)**
9. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pytest –∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ unit-—Ç–µ—Å—Ç–æ–≤
10. ‚è≥ CI/CD pipeline

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- ‚úÖ –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç < 800 —Å—Ç—Ä–æ–∫
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å - –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å - –ø—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
- ‚úÖ –Ø—Å–Ω–æ—Å—Ç—å - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (SRP)
- ‚úÖ MyPy + Ruff - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ —á–∏—Å—Ç—ã–π –∫–æ–¥
- ‚úÖ Hardware Acceleration - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ Comprehensive Error Handling - fallback –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ

---

## –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫

```bash
# MyPy –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
uv run mypy src/media/

# Ruff –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è
uv run ruff check src/media/

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
uv run ruff format src/media/

# Unit-—Ç–µ—Å—Ç—ã (TODO)
pytest tests/media/
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π `BaseProcessor`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã `process()` –∏ `needs_processing()`
3. –î–æ–±–∞–≤—å—Ç–µ –∏–º–ø–æ—Ä—Ç –≤ `processors/__init__.py`
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `manager.py`

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ì–û–¢–û–í–´–ï –ú–û–î–£–õ–ò (–ü–†–û–¶–ï–°–°–û–†–´):
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
MediaDownloader     499 —Å—Ç—Ä–æ–∫   ‚úÖ 100% —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
VideoProcessor      707 —Å—Ç—Ä–æ–∫   ‚úÖ 100% —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
AudioProcessor      360 —Å—Ç—Ä–æ–∫   ‚úÖ 100% —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
ImageProcessor      366 —Å—Ç—Ä–æ–∫   ‚úÖ 100% —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
MediaProcessor      785 —Å—Ç—Ä–æ–∫   ‚úÖ 100% —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ò–¢–û–ì–û:            2,717 —Å—Ç—Ä–æ–∫   ‚úÖ –†–ï–§–ê–ö–¢–û–†–ò–ù–ì –ó–ê–í–ï–†–®–ï–ù
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê:
  - models.py           60 —Å—Ç—Ä–æ–∫
  - hardware.py        166 —Å—Ç—Ä–æ–∫
  - metadata.py        162 —Å—Ç—Ä–æ–∫
  - validators.py      166 —Å—Ç—Ä–æ–∫
  - cache.py            69 —Å—Ç—Ä–æ–∫
  - processors/base.py  55 —Å—Ç—Ä–æ–∫
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:      678 —Å—Ç—Ä–æ–∫
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–í–°–ï–ì–û –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:   3,395 —Å—Ç—Ä–æ–∫
–°–¢–ê–†–´–ô MONOLITH (—É–¥–∞–ª–µ–Ω):  2,719 —Å—Ç—Ä–æ–∫

–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–¥–∞:           +676 —Å—Ç—Ä–æ–∫ (+25%)
–í—ã–∏–≥—Ä—ã—à:                   –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å, —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å, maintainability
```

---

## üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **100% —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω**
‚úÖ **–°—Ç–∞—Ä—ã–π –º–æ–Ω–æ–ª–∏—Ç (2719 —Å—Ç—Ä–æ–∫) —É–¥–∞–ª–µ–Ω**
‚úÖ **–ö–æ–º–ø–æ–∑–∏—Ü–∏—è –≤–º–µ—Å—Ç–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è**
‚úÖ **MyPy: 0 –æ—à–∏–±–æ–∫ (32 —Ñ–∞–π–ª–∞)**
‚úÖ **Ruff: 0 –ø—Ä–æ–±–ª–µ–º**
‚úÖ **–ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è**
‚úÖ **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
‚úÖ **Hardware acceleration support**
‚úÖ **Comprehensive error handling**

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pytest –∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ unit-—Ç–µ—Å—Ç–æ–≤
2. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
3. ‚è≥ GitHub Actions CI/CD pipeline
4. ‚è≥ Pre-commit hooks (mypy + ruff)
